<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Redemption</title>
    <style>
        body {
            background-color: black;
            color: red;
            font-family: Arial, sans-serif;
        }
        .release-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-evenly;
        }
        .release {
            margin: 20px;
            text-align: center;
        }
        iframe {
            border: none;
            width: 350px;
            height: 522px;
        }
        button {
            background-color: red;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:disabled {
            background-color: gray;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

<h1>Available Codes Below</h1>
<div id="status">Loading...</div>

<div class="release-container" id="releases">
    <!-- Releases and embedded players will be populated here -->
</div>

<script>
    // Web app URL
    const webAppUrl = "https://script.google.com/macros/s/AKfycbz3thNnshDQkcoTg6bqa4VIdj9VfBXB9frUkO_g-zMvkzcsciyRFSOqdxxWo0JnaSpP/exec";

    // Track data for the embedded players
    const releasesData = [
        {
            name: "Pandemonium",
            albumId: "2458287885",
            playerHeight: 621
        },
        {
            name: "Boombox",
            albumId: "4130268599",
            playerHeight: 522
        },
        {
            name: "Prophet for Profit Remix",
            albumId: "3303775705",
            playerHeight: 522
        },
        {
            name: "Vilicus",
            trackId: "2254569586",
            playerHeight: 442
        },
        {
            name: "Hiraeth",
            albumId: "2580754490",
            playerHeight: 522
        },
        {
            name: "Apoplectic",
            albumId: "3391838132",
            playerHeight: 522
        },
        {
            name: "Machiavellian",
            albumId: "4104591744",
            playerHeight: 522
        },
        {
            name: "Origins of Belief",
            albumId: "2582855009",
            playerHeight: 720
        },
        {
            name: "2.0",
            albumId: "2886633887",
            playerHeight: 786
        }
    ];

    // Fetch available codes from the web app
    fetch(webAppUrl)
        .then(response => response.json())
        .then(data => {
            document.getElementById("status").innerText = ""; // Clear loading message
            const releasesContainer = document.getElementById("releases");

            // For each release, check if there are available codes
            releasesData.forEach(release => {
                const releaseName = release.name;
                const availableRelease = data.find(item => item.releaseName === releaseName);

                if (availableRelease) {
                    const releaseDiv = document.createElement("div");
                    releaseDiv.classList.add("release");

                    // Create the embedded player iframe
                    const iframe = document.createElement("iframe");
                    iframe.src = `https://bandcamp.com/EmbeddedPlayer/album=${release.albumId || release.trackId}/size=large/bgcol=333333/linkcol=0f91ff/transparent=true/`;

                    // Add the link with the release name
                    const link = document.createElement("a");
                    link.href = `https://sevaskar.bandcamp.com/album/${releaseName.toLowerCase().replace(/\s+/g, '-')}`;
                    link.textContent = `${releaseName} by Sevaskar`;

                    // Create the redemption button
                    const button = document.createElement("button");
                    button.textContent = availableRelease.remainingCodes > 0 ? `Redeem Code (${availableRelease.remainingCodes} left)` : "No Codes Available";
                    button.disabled = availableRelease.remainingCodes <= 0;
                    button.addEventListener("click", function() {
                        // Handle code redemption logic (you can trigger another API call here)
                        alert(`Redeeming code for ${releaseName}`);
                    });

                    // Append the iframe, link, and button to the release div
                    releaseDiv.appendChild(iframe);
                    releaseDiv.appendChild(link);
                    releaseDiv.appendChild(button);

                    // Append the release div to the container
                    releasesContainer.appendChild(releaseDiv);
                }
            });
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById("status").innerText = 'Failed to load available codes.';
        });
</script>

</body>
</html>
