<input type="text" id="bandcamp-url" placeholder="Enter your Bandcamp URL">
<button id="redeem-button">Redeem Code</button>
<script src="redeem.js"></script>
document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("redeem-button").addEventListener("click", function () {
        let userUrl = document.getElementById("bandcamp-url").value;
        if (!userUrl) {
            alert("Please enter your Bandcamp URL.");
            return;
        }

        fetch("https://script.google.com/macros/s/AKfycbz_UhnHUo4atYBVxwOU8kRVb3LC-1BX-UqWOyT25Qw/dev", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userUrl: userUrl })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.open(`https://sevaskar.bandcamp.com/yum?code=${data.code}`, "_blank");
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error("Error:", error));
    });
});
document.querySelectorAll(".redeem-btn").forEach(button => {
    button.addEventListener("click", async (event) => {
        event.preventDefault();
        
        let bandcampURL = prompt("Enter your Bandcamp URL:");
        if (!bandcampURL) {
            alert("Bandcamp URL is required.");
            return;
        }

        let album = event.target.getAttribute("href").split("=")[1]; // Get album name from URL

        let requestData = {
            bandcampURL: bandcampURL,
            album: album
        };

        try {
            let response = await fetch("https://script.google.com/macros/s/AKfycbz_UhnHUo4atYBVxwOU8kRVb3LC-1BX-UqWOyT25Qw/dev", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestData)
            });

            let result = await response.json();
            if (result.status === "success") {
                alert(`Code Redeemed: ${result.code}`);
            } else {
                alert(`Error: ${result.message}`);
            }
        } catch (error) {
            console.error("Request failed:", error);
            alert("Something went wrong. Try again.");
        }
    });
});
